(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{a:()=>w});var t=0;function r(e,r,o){var n=o.content.cloneNode(!0),c=n.querySelector(".elements__caption"),a=n.querySelector(".elements__image"),u=n.querySelector(".elements__button"),i=n.querySelector(".elements__trash"),l=n.querySelector(".elements__like-counter");return e.owner._id!==w&&i.setAttribute("style","display:none"),void 0!==e.likes&&(t=e.likes.length),e.likes.forEach((function(e){null!==w&&e._id===w&&u.classList.add("elements__button_active")})),l.textContent=t,u.addEventListener("click",r.clickLike),u.setAttribute("internal_id",e._id),i.formOpen=document.querySelector("#formOpenTrashCard"),i.addEventListener("click",(function(t){i.closest(".elements__foto").remove(),r.deleteCard(e._id)})),a.addEventListener("click",r.openPicture),a.formOpen=document.querySelector("#bigPicture"),c.textContent=e.name,a.src=e.link,a.alt=e.name,n}var o={headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},c=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.classList.add(r.activeButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.classList.remove(r.activeButtonClass),t.disabled=!0)},a=function(e,t){t.classList.add(e.inactiveButtonClass),t.classList.remove(e.activeButtonClass)},u=document.querySelector(".form__line_box_name"),i=document.querySelector(".form__line_box_description"),l=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),d=document.querySelector(".profile__avatar"),m=document.querySelector("#bigPicture"),f=m.querySelector(".form__caption"),v=m.querySelector(".form__image"),p=(document.querySelector(".profile__add-picture").querySelector(".form__button"),document.querySelector("#elementsList")),y=(document.querySelector("#newCardButton"),document.querySelector("#profileNameChange"),document.querySelector("#formButtonAvatar"),{formSelector:".form",formPopup:".form__position",inputSelector:".form__line",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",activeButtonClass:"form__button_active",inputErrorClass:"form__line_type_error",errorClass:"form__line-error_active",formButtonAvatar:"formButtonAvatar",profileNameChange:"profileNameChange"});function _(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function h(e){e.currentTarget.formOpen.classList.add("form_opened"),document.addEventListener("keydown",q),e.currentTarget.formOpen.addEventListener("click",S)}function S(e){var t=document.querySelector(".form_opened");if(null!==t){var r=t.querySelector(".form__popup");e.composedPath().includes(r)||C(e.currentTarget)}}function C(e){var t=e;null!=e.currentTarget&&null!=e.currentTarget.formClose&&(t=e.currentTarget.formClose),document.removeEventListener("keydown",q),t.removeEventListener("click",S),t.classList.remove("form_opened")}function q(e){"Escape"===e.key&&C(document.querySelector(".form_opened"))}var g=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-picture"),E=document.querySelector(".profile__avatar-change"),L=document.querySelector("#formClose"),k=document.querySelector("#formCloseAvatar"),O=document.querySelector("#formClosePicture"),P=document.querySelector("#profileName"),A=document.querySelector("#profilePicture"),B=document.querySelector("#avatarPicture"),T=document.querySelector("#formCloseBigPicture");g.formOpen=document.querySelector("#formOpen"),E.formOpen=document.querySelector("#formOpenAvatar");var x=document.querySelector("#profileNameChange"),N=document.querySelector("#newCardButton");b.formOpen=document.querySelector("#formOpenPicture"),k.formClose=document.querySelector("#formOpenAvatar"),L.formClose=document.querySelector("#formOpen"),O.formClose=document.querySelector("#formOpenPicture"),P.formClose=document.querySelector("#formOpen"),A.formClose=document.querySelector("#formOpenPicture"),T.formClose=document.querySelector("#bigPicture"),B.formClose=document.querySelector("#formOpenAvatar");var w,D=document.getElementById("title-input"),J=document.getElementById("url-input"),j=document.getElementById("url-avatar"),I=document.querySelector("#formButtonAvatar");I.formClose=document.querySelector("#formOpenAvatar");var M={openPicture:function(e){v.src=e.target.src,v.alt=e.target.alt,f.textContent=e.target.parentNode.querySelector(".elements__caption").textContent,h(e)},clickLike:function(e){e.currentTarget.classList.toggle("elements__button_active"),function(e){var t=e.currentTarget.getAttribute("internal_id");e.currentTarget.classList.contains("elements__button_active")?(function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"PUT",headers:o.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))}(t).catch((function(e){console.log(e)})),e.currentTarget.parentElement.querySelector(".elements__like-counter").textContent-=-1):(function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"DELETE",headers:o.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))}(t).catch((function(e){console.log(e)})),e.currentTarget.parentElement.querySelector(".elements__like-counter").textContent-=1)}(e)},deleteCard:function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-14/cards/"+e,{method:"DELETE",headers:o.headers,body:JSON.stringify({_id:e})}).then((function(e){return n(e)}))}};function H(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?p.parentNode.prepend(e):p.parentNode.append(e)}fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{headers:o.headers}).then((function(e){return n(e)})).then((function(e){var t;d.src=e.avatar,l.textContent=e.name,s.textContent=e.about,u.value=e.name,i.value=e.about,t=e._id,void 0===w&&(w=t),console.log(e.avatar)})).then((function(){return fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{headers:o.headers}).then((function(e){return n(e)}))})).then((function(e){e.forEach((function(e){H(r(e,M,p))}))})).catch((function(e){console.log(e)})),g.addEventListener("click",h),b.addEventListener("click",h),E.addEventListener("click",h),O.addEventListener("click",C),T.addEventListener("click",C),L.addEventListener("click",C),k.addEventListener("click",C),P.addEventListener("submit",(function(e){var t,r;_(!0,x),e.preventDefault(),l.textContent=u.value,s.textContent=i.value,(t=u.value,r=i.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:r})}).then((function(e){return n(e)}))).then((function(t){a(y,x),C(e.target.formClose)})).catch((function(e){console.log(e)})).finally((function(){_(!1,x)}))})),A.addEventListener("submit",(function(e){var t,c;_(!0,N),e.preventDefault(),(t=D.value,c=J.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:c})}).then((function(e){return n(e)}))).then((function(t){a(y,N),C(e.target.formClose),H(r(t,M,p),!0),D.value="",J.value=""})).catch((function(e){console.log(e)})).finally((function(){_(!1,N)}))})),B.addEventListener("submit",(function(e){var t;_(!0,I),e.preventDefault(),d.src=j.value,(t=j.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me/avatar",{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return n(e)}))).then((function(t){a(y,I),C(e.target.formClose),j.value=""})).catch((function(e){console.log(e)})).finally((function(){_(!1,I)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formPopup)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);c(r,o,t),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""}(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,t.validationMessage,r)}(e,n,t),c(r,o,t)}))}))}(t,e)}))}))}(y)})();