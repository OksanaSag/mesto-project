(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);var t=Array.from(document.querySelectorAll(".form"));function o(e){e.currentTarget.formOpen.classList.add("form_opened"),document.addEventListener("keydown",c),t.forEach((function(e){e.addEventListener("click",n)}))}function n(e){var t=document.querySelector(".form_opened");if(null!=t){var o=t.querySelector(".form__popup");e.composedPath().includes(o)||r()}}function r(e){document.removeEventListener("keydown",c),t.forEach((function(e){e.removeEventListener("click",n)})),document.querySelector(".form_opened").classList.remove("form_opened")}function c(e){"Escape"===e.key&&(document.querySelector(".form_opened"),r())}function a(t){e.formImage.src=t.target.src,e.formImage.alt=t.target.alt,e.pictureCaption.textContent=t.target.parentNode.querySelector(".elements__caption").textContent,o(t)}function i(t){var n=e.template.content.cloneNode(!0),c=n.querySelector(".elements__caption"),i=n.querySelector(".elements__image"),u=n.querySelector(".elements__button"),s=n.querySelector(".elements__trash"),l=n.querySelector(".elements__like-counter"),d=0;return t.owner._id!==h&&s.setAttribute("style","display:none"),null!=t.likes&&(d=t.likes.length),t.likes.forEach((function(e){null!=h&&e._id==h&&u.classList.add("elements__button_active")})),l.textContent=d,u.addEventListener("click",(function(e){u.classList.toggle("elements__button_active"),function(e){var t=e.currentTarget.getAttribute("internal_id");u.classList.contains("elements__button_active")?(q(t),l.innerHTML=d+=1):(C(t),l.innerHTML=d-=1)}(e)})),u.setAttribute("internal_id",t._id),s.formOpen=document.querySelector("#formOpenTrashCard"),s.addEventListener("click",(function(e){o(e),s.closest(".elements__foto").remove(),r(),g(t._id)})),i.addEventListener("click",a),i.formOpen=document.querySelector("#bigPicture"),c.textContent=t.name,i.src=t.link,i.alt=t.name,n}function u(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o?e.template.parentNode.prepend(t):e.template.parentNode.append(t)}var s=document.querySelector(".form__line_box_name"),l=document.querySelector(".form__line_box_description"),d=document.querySelector(".profile__name"),m=document.querySelector(".profile__description"),f=document.querySelector(".profile__avatar"),p=(document.querySelector("#elementsList"),document.querySelector("#bigPicture")),v=(p.querySelector(".form__caption"),p.querySelector(".form__image"),newPictureButton.formOpen.querySelector(".form__button")),y={formSelector:".form",formPopup:".form__position",inputSelector:".form__line",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",activeButtonClass:"form__button_active",inputErrorClass:"form__line_type_error",errorClass:"form__line-error_active",formButtonAvatar:"formButtonAvatar",profileNameChange:"profileNameChange"};function _(e){Array.from(document.querySelectorAll(".form__button")).forEach((function(e){e.innerText="Сохранить"}))}var h,S=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.classList.add(o.activeButtonClass),t.disabled=!1):(t.classList.add(o.inactiveButtonClass),t.classList.remove(o.activeButtonClass),t.disabled=!0)},b=function(e,t){t.classList.add(e.inactiveButtonClass),t.classList.remove(e.activeButtonClass)};fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e),e.forEach((function(e){u(i(e))}))})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){f.src=e.avatar,d.textContent=e.name,m.textContent=e.about,s.value=e.name,l.value=e.about,h=e._id,console.log(e.avatar)})).catch((function(e){console.log(e)}));var q=function(e){fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"PUT",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){})).catch((function(e){console.log(e)}))},C=function(e){fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"DELETE",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},g=function(e){fetch("https://nomoreparties.co/v1/plus-cohort-14/cards/"+e,{method:"DELETE",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))},E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-picture"),k=document.querySelector(".profile__avatar-change"),P=document.querySelector("#formClose"),j=document.querySelector("#formCloseAvatar"),O=document.querySelector("#formClosePicture"),A=document.querySelector("#profileName"),T=document.querySelector("#profilePicture"),B=document.querySelector("#avatarPicture"),N=document.querySelector("#formCloseBigPicture");E.formOpen=document.querySelector("#formOpen"),k.formOpen=document.querySelector("#formOpenAvatar");var x=document.querySelector("#profileNameChange"),I=document.querySelector("#newCardButton");L.formOpen=document.querySelector("#formOpenPicture"),j.formClose=document.querySelector("#formOpenAvatar"),P.formClose=document.querySelector("#formOpen"),O.formClose=document.querySelector("#formOpenPicture"),A.formClose=document.querySelector("#formOpen"),T.formClose=document.querySelector("#formOpenPicture"),N.formClose=document.querySelector("#bigPicture");var z=document.getElementById("title-input"),D=document.getElementById("url-input"),M=document.getElementById("url-avatar"),J=document.querySelector("#formButtonAvatar");function w(e){e.target.innerText="Сохранение..."}J.formClose=document.querySelector("#formOpenAvatar"),E.addEventListener("click",o),L.addEventListener("click",o),k.addEventListener("click",o),O.addEventListener("click",r),N.addEventListener("click",r),P.addEventListener("click",r),j.addEventListener("click",r),A.addEventListener("submit",(function(e){var t,o;e.preventDefault(),profileName.textContent=nameInput.value,profileDescription.textContent=jobInput.value,t=nameInput.value,o=jobInput.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{method:"PATCH",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b(y,v),r(),_()})).catch((function(e){console.log(e)}))})),T.addEventListener("submit",(function(e){var t,o;e.preventDefault(),z.value,D.value,t=z.value,o=D.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{method:"POST",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b(y,v),r(),_(),u(i(e),!0)})).catch((function(e){console.log(e)})),z.value="",D.value=""})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),profileAvatar.src=M.value,t=M.value,fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me/avatar",{method:"PATCH",headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t=e.avatar,b(y,v),r(),_()})).catch((function(e){console.log(e)})),M.value=""})),x.addEventListener("click",w),I.addEventListener("click",w),J.addEventListener("click",w),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formPopup)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);S(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),S(o,n,t)}))}))}(t,e)}))}))}(enable)})();