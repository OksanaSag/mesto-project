(()=>{"use strict";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{d:()=>F});var t=document.querySelector(".form__line_box_name"),r=document.querySelector(".form__line_box_description"),o=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),c=document.querySelector(".profile__avatar"),a=document.querySelector("#bigPicture"),u=a.querySelector(".form__caption"),i=a.querySelector(".form__image"),l=(document.querySelector(".profile__add-picture").querySelector(".form__button"),document.querySelector("#elementsList")),s=document.querySelector("#newCardButton"),d=document.querySelector("#profileNameChange"),m=document.querySelector("#formButtonAvatar"),f={formSelector:".form",formPopup:".form__position",inputSelector:".form__line",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",activeButtonClass:"form__button_active",inputErrorClass:"form__line_type_error",errorClass:"form__line-error_active",formButtonAvatar:"formButtonAvatar",profileNameChange:"profileNameChange"};function v(e){e.currentTarget.formOpen.classList.add("form_opened"),document.addEventListener("keydown",h),e.currentTarget.formOpen.addEventListener("click",p)}function p(e){var t=document.querySelector(".form_opened");if(null!==t){var r=t.querySelector(".form__popup");e.composedPath().includes(r)||_(e.currentTarget)}}function y(e){_(e.currentTarget.formClose)}function _(e){document.removeEventListener("keydown",h),e.removeEventListener("click",p),e.classList.remove("form_opened")}function h(e){"Escape"===e.key&&_(document.querySelector(".form_opened"))}function S(e){i.src=e.target.src,i.alt=e.target.alt,u.textContent=e.target.parentNode.querySelector(".elements__caption").textContent,v(e)}Array.from(document.querySelectorAll(".form"));var C,q=function(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.classList.add(r.activeButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.classList.remove(r.activeButtonClass),t.disabled=!0)},g=function(e,t){t.classList.add(e.inactiveButtonClass),t.classList.remove(e.activeButtonClass)},E={headers:{authorization:"2b115875-5f8a-40be-8d8a-4a3dc9ce97a5","Content-Type":"application/json"}},L=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},b=0;function k(e){var t=l.content.cloneNode(!0),r=t.querySelector(".elements__caption"),o=t.querySelector(".elements__image"),n=t.querySelector(".elements__button"),c=t.querySelector(".elements__trash"),a=t.querySelector(".elements__like-counter");return e.owner._id!==C&&c.setAttribute("style","display:none"),void 0!==e.likes&&(b=e.likes.length),e.likes.forEach((function(e){null!==C&&e._id===C&&n.classList.add("elements__button_active")})),a.textContent=b,n.addEventListener("click",O),n.setAttribute("internal_id",e._id),c.formOpen=document.querySelector("#formOpenTrashCard"),c.addEventListener("click",(function(t){var r;c.closest(".elements__foto").remove(),r=e._id,fetch("https://nomoreparties.co/v1/plus-cohort-14/cards/"+r,{method:"DELETE",headers:E.headers,body:JSON.stringify({_id:r})}).then((function(e){return L(e)})).catch((function(e){console.log(e)}))})),o.addEventListener("click",S),o.formOpen=document.querySelector("#bigPicture"),r.textContent=e.name,o.src=e.link,o.alt=e.name,t}function O(e){e.currentTarget.classList.toggle("elements__button_active"),function(e){var t=e.currentTarget.getAttribute("internal_id");e.currentTarget.classList.contains("elements__button_active")?(function(e){fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"PUT",headers:E.headers,body:JSON.stringify({_id:e})}).then((function(e){return L(e)})).then((function(e){})).catch((function(e){console.log(e)}))}(t),e.currentTarget.parentElement.querySelector(".elements__like-counter").textContent-=-1):(function(e){fetch("https://nomoreparties.co/v1/plus-cohort-14//cards/likes/"+e,{method:"DELETE",headers:E.headers,body:JSON.stringify({_id:e})}).then((function(e){return L(e)})).catch((function(e){console.log(e)}))}(t),e.currentTarget.parentElement.querySelector(".elements__like-counter").textContent-=1)}(e)}var A=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-picture"),B=document.querySelector(".profile__avatar-change"),P=document.querySelector("#formClose"),T=document.querySelector("#formCloseAvatar"),N=document.querySelector("#formClosePicture"),w=document.querySelector("#profileName"),D=document.querySelector("#profilePicture"),J=document.querySelector("#avatarPicture"),j=document.querySelector("#formCloseBigPicture");A.formOpen=document.querySelector("#formOpen"),B.formOpen=document.querySelector("#formOpenAvatar");var I=document.querySelector("#profileNameChange"),M=document.querySelector("#newCardButton");x.formOpen=document.querySelector("#formOpenPicture"),T.formClose=document.querySelector("#formOpenAvatar"),P.formClose=document.querySelector("#formOpen"),N.formClose=document.querySelector("#formOpenPicture"),w.formClose=document.querySelector("#formOpen"),D.formClose=document.querySelector("#formOpenPicture"),j.formClose=document.querySelector("#bigPicture"),J.formClose=document.querySelector("#formOpenAvatar");var H=document.getElementById("title-input"),V=document.getElementById("url-input"),z=document.getElementById("url-avatar"),U=document.querySelector("#formButtonAvatar");function F(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?l.parentNode.prepend(e):l.parentNode.append(e)}U.formClose=document.querySelector("#formOpenAvatar"),fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{headers:E.headers}).then((function(e){return L(e)})).then((function(e){console.log(e),e.forEach((function(e){F(k(e))}))})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{headers:E.headers}).then((function(e){return L(e)})).then((function(e){var a;c.src=e.avatar,o.textContent=e.name,n.textContent=e.about,t.value=e.name,r.value=e.about,a=e._id,null==C&&(C=a),console.log(e.avatar)})).catch((function(e){console.log(e)})),A.addEventListener("click",v),x.addEventListener("click",v),B.addEventListener("click",v),N.addEventListener("click",y),j.addEventListener("click",y),P.addEventListener("click",y),T.addEventListener("click",y),w.addEventListener("submit",(function(e){e.preventDefault(),o.textContent=t.value,n.textContent=r.value,function(e,t,r){fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me",{method:"PATCH",headers:E.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return L(e)})).then((function(e){g(f,d),_(r.target.formClose),d.textContent="Сохранить"})).catch((function(e){console.log(e)}))}(t.value,r.value,e)})),D.addEventListener("submit",(function(e){e.preventDefault(),H.value,V.value,function(e,t,r){fetch("https://nomoreparties.co/v1/plus-cohort-14/cards",{method:"POST",headers:E.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return L(e)})).then((function(e){g(f,s),_(r.target.formClose),s.textContent="Сохранить",F(k(e),!0)})).catch((function(e){console.log(e)}))}(H.value,V.value,e),H.value="",V.value=""})),J.addEventListener("submit",(function(e){e.preventDefault(),c.src=z.value,function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-14/users/me/avatar",{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:e})}).then((function(e){return L(e)})).then((function(r){e=r.avatar,g(f,m),_(t.target.formClose),m.textContent="Сохранить"})).catch((function(e){console.log(e)}))}(z.value,e),z.value=""})),I.addEventListener("click",(function(e){e.target.textContent="Сохранение..."})),M.addEventListener("click",(function(e){e.target.textContent="Сохранение..."})),U.addEventListener("click",(function(e){e.target.textContent="Сохранение..."})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formPopup)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);q(r,o,t),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""}(e,t,r):function(e,t,r,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)}(e,t,t.validationMessage,r)}(e,n,t),q(r,o,t)}))}))}(t,e)}))}))}(f)})();